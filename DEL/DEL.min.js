/**
 * DOM Event Listener
 * @author  RubaXa  <trash@rubaxa.org>
 */
(function(k,h,q){var m="string",d=" ",b=false,g=true,K=1,i={},f="prototype",C=Array[f].slice,D=Object[f].toString,B=Function[f].bind,I=/(^\s+|\s+$)/g,x=/\s+/g,v=/^\[([^\]]+)\]\s*/i,M=function(){},e=k.document,s="EventListener",r="add"+s,E="remove"+s,o=function(){return g},n=function(){return b},a={props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(d),fix:function(a){return new w(a)},map:{blur:"focusout",focus:"focusin",mouseenter:"mouseover",mouseleave:"mouseout"},"short":{hover:"mouseenter mouseleave"},special:{mouseenter:t,mouseleave:t},split:function(b){b=(d+b+d).replace(/\s([^\s]+)/,function(c,b){return d+(a.short[b]||b)});return A(b,"trim").split(x)}};function t(f,d){var a=f.relatedTarget,c=b;if(a!==d){if(a)do if(a===d){c=g;break}while((a=a.parentNode)&&a!==e.body);return!c}return b}function H(b,e){var d=C.call(arguments,2);if(B!==q)return B.apply(e,[b].concat(d));var a=function(){},c=function(){return e.apply(this instanceof a?this:b||k,d.concat(C.call(arguments)))};a[f]=b[f];c[f]=new a;return c}function y(a){return a&&a.nodeType==1}function J(a){return D.call(a)=="[object Object]"}function L(a){return D.call(a)=="[object Function]"}function A(a,b){return b==="trim"?a.replace(I,""):a.replace(x,"")}function l(a,e,c,d){if(y(a))if(h)h.event[e?"add":"remove"](a,c,d);else if(a[r])a[e?r:E](c,d,b);else a[e?"attachEvent":"detachEvent"]("on"+c,d)}function c(a,d){if(typeof a==m||y(a))a=[a];if("forEach"in a)a.forEach(d);else if("length"in a)for(var b=0,e=a.length;b<e;b++)b in a&&d.call(this,a[b],b);else for(var c in a)a.hasOwnProperty(c)&&d.call(this,a[c],c)}function G(c,a){if("id"in a)return c.id==a.id;else if(!("tag"in a)||c.tagName==a.tag){if("mod"in a)for(var h=d+c.className+d,e=a.mod,f=e.length;f--;)if(!~h.indexOf(d+e[f]+d))return b;return g}return b}function w(g){var f=null,b=this;b.type=g.type;b.originalEvent=g;for(var j=a.props.length,h;j--;){h=a.props[j];this[h]=g[h]}if(!b.target)b.target=b.srcElement||e;if(b.target.nodeType===3)b.target=b.target.parentNode;if(!b.relatedTarget&&b.fromElement)b.relatedTarget=b.fromElement===b.target?b.toElement:b.fromElement;if(b.pageX==f&&b.clientX!=f){var i=b.target.ownerDocument||e,d=i.documentElement,c=i.body;b.pageX=b.clientX+(d&&d.scrollLeft||c&&c.scrollLeft||0)-(d&&d.clientLeft||c&&c.clientLeft||0);b.pageY=b.clientY+(d&&d.scrollTop||c&&c.scrollTop||0)-(d&&d.clientTop||c&&c.clientTop||0)}if(b.which==f&&(b.charCode!=f||b.keyCode!=f))b.which=b.charCode!=f?b.charCode:b.keyCode;if(!b.metaKey&&b.ctrlKey)b.metaKey=b.ctrlKey;if(!b.which&&b.button!==undefined)b.which=b.button&1?1:b.button&2?3:b.button&4?2:0}w[f]={preventDefault:function(){this.isDefaultPrevented=o;var a=this.originalEvent;if(a.preventDefault)a.preventDefault();else a.returnValue=b},stopPropagation:function(){this.isPropagationStopped=o;var a=this.originalEvent;a.stopPropagation&&a.stopPropagation();a.cancelBubble=g},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=o;this.stopPropagation()},isDefaultPrevented:n,isPropagationStopped:n,isImmediatePropagationStopped:n};function F(o,n,c){c=a.fix(c||k.event);var m=i[o],g,l,j=c.type,d=c.target,e,f=m[j],h;if(f&&f.length)do if(d.nodeType==1)for(g=0,l=f.length;g<l;g++){e=f[g];if(G(d,e)){h=a.special[e.type];if(h===q||h(c,d)){c.type=e.type;c.currentTarget=d;if(e.fn.call(d,c)===b){c.preventDefault();c.stopPropagation()}c.type=j;if(c.isPropagationStopped())return}}}while((d=d.parentNode)&&n!==d)}function p(e,b,c,f){b=A(b);var d={type:c,fn:f,sel:b};if(b.charAt(0)=="#")d.id=b.substr(1);else{b=b.split(".");if(b[0])d.tag=b[0].toUpperCase();if(b.length>1)d.mod=b.slice(1)}c=a.map[c]||c;(e[c]=e[c]||[]).push(d)}function u(d,a){c(a,function(e,c){if(c!="fn"){l(d,b,c,a.fn);e.length&&l(d,g,c,a.fn)}})}function z(d,b,f,g){if(!b){b=d;d=e.body}else if(f&&!g){g=f;f=b;b=d;d=e.body}if(typeof b==m){var h={};h["["+b+"] "+f]=g;b=h}c(d,function(e){var f=e.uniqId||(e.uniqId=++K),d=i[f]=i[f]||{},g;c(b,function(e,b){if(g=b.match(v)){b=b.replace(v,"");c(a.split(g[1]),function(a){c(b.split(","),function(b){p(d,b,a,e)})})}else if(J(e))c(e,function(e,c){p(d,b,a.split(c),e)});else p(d,b,"click",e)});if(!d.fn)d.fn=H(M,F,f,e);u(e,d)})}function j(d,f,b,g){if(typeof d==m){g=b;b=f;f=d;d=e.body}if(L(b)||b===q){j(d,f,"",b);j(d,"",f,b);return}c(d,function(d){if(d.uniqId&&i[d.uniqId]){var e=i[d.uniqId];c(e,function(h,l){if(l!=="fn"){for(var m=h.length,j=h.length,i,k;j--;){i=h[j];c(a.split(f),function(a){k=(!a||a==i.type)&&(!g||g===i.fn)&&(!b||b.toLowerCase()==i.sel.toLowerCase());if(k)h=h.slice(0,j).concat(h.slice(j+1))})}e[l]=h;u(d,e)}})}})}if(h){a.fix=function(a){return a};a.props=h.event.props;h.fn.listen=function(a,b,c){z(this,a,b,c);return this};h.fn.unlisten=function(a,b,c){j(this,a,b,c);return this}}l(e,g,"propertychange",function(){});k.DOMListen={on:z,off:j,event:a}})(this,this.jQuery);
